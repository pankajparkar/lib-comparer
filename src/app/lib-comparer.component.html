<nav class="top-nav">
  <div class="brand">
  <img src="/logo.svg" alt="Lib Comparer" width="24" height="24" />
    <span>Lib Comparer</span>
  </div>
  <a class="gh-link" href="https://github.com/pankajparkar/lib-comparer" target="_blank" rel="noopener" aria-label="View on GitHub">
    <svg viewBox="0 0 16 16" width="18" height="18" aria-hidden="true" focusable="false"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.6 7.6 0 0 1 2-.27c.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8Z"></path></svg>
    <span class="sr-only">GitHub</span>
  </a>
</nav>

<div class="lib-comparer-container">
  <header class="lib-comparer-header">
  <img src="/assets/logo.svg" alt="Lib Comparer Logo" width="40" height="40" />
    <h1>Library & Framework Comparer</h1>
    <p class="subtitle">Find the best libraries for your needs, with real-time stats from GitHub & npm.</p>
  </header>

  @let isLoading = this.recResource.isLoading();
  @let err = this.recResource.error();
  @let recommendations = this.recResource.value();
  <form (ngSubmit)="searchLibraries()" class="lib-comparer-form">
    <div class="form-group">
      <label for="framework">Library/Framework</label>
      <select id="framework" [(ngModel)]="selectedFramework" name="framework" required>
        <option value="" disabled selected>Select a framework</option>
        @for(fw of frameworks; track fw) {
          <option [value]="fw">{{ fw }}</option>
        }
      </select>
    </div>
    <div class="form-group">
      <label for="functionality">Functionality</label>
      <input id="functionality" type="text" [(ngModel)]="functionality" name="functionality" placeholder="e.g. datepicker, select" required />
    </div>
    <button type="submit" [disabled]="isLoading" class="primary-btn">
      @if(!isLoading) {
        <span>üîç Recommend</span>
      }
      @if(isLoading) {
        <span>‚è≥ Loading...</span>
      }
    </button>
  </form>

  @if(err) {
    <div class="error-banner">API error: {{ err.message }}</div>
  }

  @if(recommendations?.length ?? 0 > 0) {
    <div class="sort-bar">
      <span>Sort by:</span>
      <button type="button" class="chip" [class.active]="sortBy() === 'score'" (click)="setSort('score')">Best</button>
      <button type="button" class="chip" [class.active]="sortBy() === 'stars'" (click)="setSort('stars')">Stars</button>
      <button type="button" class="chip" [class.active]="sortBy() === 'downloads'" (click)="setSort('downloads')">Downloads</button>
      <button type="button" class="chip" [class.active]="sortBy() === 'recent'" (click)="setSort('recent')">Recent</button>
    </div>
  }

  @if(recommendations?.length ?? 0 > 0) {
    <section class="recommendations">
      <h2>Top Recommendations</h2>
      <div class="card-list">
        @for(lib of recommendations; track lib.name) {
          <div class="lib-card">
            <div class="lib-card-header">
              <h3>
                <a [href]="lib.repoUrl" target="_blank" rel="noopener">{{ lib.name }}</a>
              </h3>
              <a [href]="lib.npmUrl" target="_blank" rel="noopener" class="npm-link">NPM</a>
            </div>
            <ul class="lib-stats">
              <li><span class="stat-label">‚≠ê Stars:</span> <strong>{{ lib.stars | number }}</strong></li>
              <li><span class="stat-label">‚¨áÔ∏è NPM Downloads:</span> <strong>{{ lib.downloads | number }}</strong></li>
              @if(lib.bundleSize || lib.gzipSize) {
                <li><span class="stat-label">üì¶ Bundle:</span>
                  <strong>
                    @if(lib.bundleSize) { min {{ (lib.bundleSize!/1024) | number:'1.0-1' }} kB }
                    @if(lib.gzipSize) {, gzip {{ (lib.gzipSize!/1024) | number:'1.0-1' }} kB }
                  </strong>
                  <span class="help" title="Bundle sizes from BundleJS; gzip may be computed in-browser and can vary slightly.">‚ìò</span>
                </li>
              }
              @else {
                <li><span class="stat-label">üì¶ Repo Size:</span> <strong>{{ lib.size }}</strong></li>
              }
              <li><span class="stat-label">üç¥ Forks:</span> <strong>{{ lib.forks | number }}</strong></li>
              <li><span class="stat-label">üêõ Issues:</span> <strong>{{ lib.issues | number }}</strong></li>
              <li><span class="stat-label">üïí Last Activity:</span> <strong>{{ lib.lastActivity | date:'mediumDate' }}</strong></li>
              <li><span class="stat-label">üëÄ Watchers:</span> <strong>{{ lib.users | number }}</strong></li>
            </ul>
          </div>
        }
      </div>
    </section>
    <div class="load-more-row">
      <button type="button" class="primary-btn" (click)="loadMore()" [disabled]="isLoading">Load more</button>
    </div>
  }

  @if(!isLoading && recommendations?.length === 0 && selectedFramework && functionality) {
    <section class="no-results">
      <p>No recommendations found. Try a different query.</p>
    </section>
  }

  @if(isLoading) {
  <div class="loading">Loading recommendations...</div>
  <lc-recommendation-shimmer [count]="4"></lc-recommendation-shimmer>
  }
</div>
